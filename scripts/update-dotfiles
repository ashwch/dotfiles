#!/bin/bash

# Update dotfiles and system packages
# Usage: ./scripts/update-dotfiles

set -e

echo "ğŸ”„ Updating dotfiles and system packages..."

# Navigate to dotfiles directory
cd "$HOME/dotfiles"

# Update Brewfile
echo "ğŸ“¦ Updating Brewfile..."
brew bundle dump --force --file=Brewfile

# Update Homebrew and packages
echo "ğŸº Updating Homebrew packages..."
brew update && brew upgrade

# Cleanup old versions
echo "ğŸ§¹ Cleaning up old package versions..."
brew cleanup

# Update dotfiles repo
echo "ğŸ“¡ Pulling latest dotfiles..."
git pull origin main

# Regenerate FZF bindings if needed
if command -v fzf >/dev/null 2>&1; then
    echo "ğŸ” Updating FZF key bindings..."
    $(brew --prefix)/opt/fzf/install --key-bindings --completion --no-update-rc
fi

echo "âœ… Dotfiles and packages updated successfully!"
echo "ğŸ”„ Restart your terminal to apply all changes"