# ==============================================================================
# tmux configuration - Hybrid Ghostty + tmux setup
# ==============================================================================
# Strategy: Ghostty handles tabs (Cmd+T, Cmd+1-9), tmux handles panes
# Prefix: Ctrl-a (more ergonomic than default Ctrl-b)
# ==============================================================================

# -----------------------------------------------------------------------------
# Prefix Key
# -----------------------------------------------------------------------------
unbind C-b
set -g prefix C-a
bind C-a send-prefix
bind -r C-a last-pane                                # Double-tap prefix: last pane

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"           # True color support
set -ga terminal-overrides ",xterm-ghostty:Tc"      # Ghostty true color

set -g mouse on                                      # Enable mouse support
set -g history-limit 50000                           # Scrollback buffer
set -g base-index 1                                  # Start windows at 1
set -g pane-base-index 1                             # Start panes at 1
set -g renumber-windows on                           # Renumber on close
set -g set-clipboard on                              # System clipboard
set -g escape-time 0                                 # No delay for escape
set -g focus-events on                               # Focus events for vim
set -g display-time 2000                             # Message display time

# -----------------------------------------------------------------------------
# Pane Splitting - Intuitive keys
# -----------------------------------------------------------------------------
# | for vertical split (side by side)
# - for horizontal split (top/bottom)
bind | split-window -h -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"   # Backslash without shift
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"    # Underscore alternative

# -----------------------------------------------------------------------------
# Pane Navigation - Vim style
# -----------------------------------------------------------------------------
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt+arrow keys (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# -----------------------------------------------------------------------------
# Ghostty Integration - Cmd+key shortcuts (no prefix needed)
# -----------------------------------------------------------------------------
# Register escape sequences from Ghostty as user-defined keys
set -s user-keys[0] "\e[1;2P"   # Cmd+D
set -s user-keys[1] "\e[1;2Q"   # Cmd+Shift+D
set -s user-keys[2] "\e[1;2R"   # Cmd+Left
set -s user-keys[3] "\e[1;2S"   # Cmd+Right
set -s user-keys[4] "\e[1;6P"   # Cmd+Up
set -s user-keys[5] "\e[1;6Q"   # Cmd+Down
set -s user-keys[6] "\e[1;6R"   # Cmd+W
set -s user-keys[7] "\e[1;6S"   # Cmd+Shift+Enter

# Bind user keys to tmux actions
bind -n User0 split-window -h -c "#{pane_current_path}"  # Cmd+D: Split right
bind -n User1 split-window -v -c "#{pane_current_path}"  # Cmd+Shift+D: Split down
bind -n User2 select-pane -L                              # Cmd+Left
bind -n User3 select-pane -R                              # Cmd+Right
bind -n User4 select-pane -U                              # Cmd+Up
bind -n User5 select-pane -D                              # Cmd+Down
bind -n User6 kill-pane                                   # Cmd+W: Close pane
bind -n User7 resize-pane -Z                              # Cmd+Shift+Enter: Zoom

# -----------------------------------------------------------------------------
# Pane Resizing
# -----------------------------------------------------------------------------
# Shift+Arrow keys (no prefix needed)
bind -n S-Left resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Up resize-pane -U 2
bind -n S-Down resize-pane -D 2

# Vim-style with prefix (larger increments)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# -----------------------------------------------------------------------------
# Window Management (minimal - Ghostty handles tabs)
# -----------------------------------------------------------------------------
bind c new-window -c "#{pane_current_path}"          # New window in same dir
bind x kill-pane                                      # Close pane (with confirm)
bind X kill-window                                    # Close window (with confirm)

# Quick window switching (backup if not using Ghostty tabs)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# -----------------------------------------------------------------------------
# Session Management
# -----------------------------------------------------------------------------
bind S choose-session                                 # Session switcher
bind N new-session                                    # New session
bind R command-prompt "rename-session '%%'"           # Rename session

# -----------------------------------------------------------------------------
# Copy Mode (vi-style)
# -----------------------------------------------------------------------------
setw -g mode-keys vi
bind Enter copy-mode                                  # Enter copy mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Escape send -X cancel

# Double-click to select word, triple-click for line
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word
bind -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line

# -----------------------------------------------------------------------------
# Utility Bindings
# -----------------------------------------------------------------------------
bind r source-file ~/.tmux.conf \; display "Config reloaded!"
bind ? list-keys                                      # Show all keybindings
bind z resize-pane -Z                                 # Toggle zoom
bind Space next-layout                                # Cycle layouts
bind = select-layout even-horizontal
bind + select-layout even-vertical

# Synchronize panes (type in all panes at once)
bind a setw synchronize-panes \; display "Sync #{?synchronize-panes,ON,OFF}"

# -----------------------------------------------------------------------------
# Status Bar - Minimal (Ghostty shows tabs)
# -----------------------------------------------------------------------------
set -g status-position bottom
set -g status-style "bg=default,fg=#928374"
set -g status-left-length 40
set -g status-right-length 60

# Left: session name
set -g status-left "#[fg=#83a598,bold] #S #[fg=#504945]│ "

# Right: pane info + time
set -g status-right "#[fg=#504945]│ #[fg=#d5c4a1]#(whoami)@#h #[fg=#504945]│ #[fg=#fabd2f]%H:%M "

# Window status (minimal since Ghostty handles main tabs)
set -g window-status-format "#[fg=#665c54] #I:#W "
set -g window-status-current-format "#[fg=#fe8019,bold] #I:#W "
set -g window-status-separator ""

# Pane borders - subtle Gruvbox colors
set -g pane-border-style "fg=#504945"
set -g pane-active-border-style "fg=#83a598"

# Message styling
set -g message-style "bg=#3c3836,fg=#ebdbb2"

# -----------------------------------------------------------------------------
# Hooks - Auto-rename based on running command
# -----------------------------------------------------------------------------
set -g automatic-rename on
set -g automatic-rename-format "#{?#{==:#{pane_current_command},zsh},#{b:pane_current_path},#{pane_current_command}}"

# ==============================================================================
# Quick Reference
# ==============================================================================
#
# GHOSTTY-STYLE (no prefix needed):
# ─────────────────────────────────
#   Cmd+D             Split right (vertical)
#   Cmd+Shift+D       Split down (horizontal)
#   Cmd+Arrow         Navigate panes
#   Cmd+W             Close pane
#   Cmd+Shift+Enter   Toggle zoom (fullscreen pane)
#
# NO-PREFIX SHORTCUTS:
# ────────────────────
#   Shift+Arrow       Resize pane
#   Alt+Arrow         Navigate panes (alternative)
#
# PREFIX SHORTCUTS (Ctrl-a):
# ──────────────────────────
#   Ctrl-a Ctrl-a     Switch to last pane (double-tap)
#   Ctrl-a |          Split right
#   Ctrl-a -          Split down
#   Ctrl-a h/j/k/l    Navigate panes (vim style)
#   Ctrl-a H/J/K/L    Resize panes (vim style, larger)
#   Ctrl-a z          Toggle zoom
#   Ctrl-a x          Close pane
#
# SESSIONS:
# ─────────
#   Ctrl-a d          Detach (session persists)
#   Ctrl-a S          Choose session
#   Ctrl-a N          New session
#   Ctrl-a $          Rename session
#
# COPY MODE:
# ──────────
#   Ctrl-a Enter      Enter copy mode
#   v                 Start selection
#   y                 Copy to clipboard
#   Escape            Exit copy mode
#
# UTILITY:
# ────────
#   Ctrl-a r          Reload config
#   Ctrl-a ?          List all keybindings
#   Ctrl-a a          Toggle sync panes (type in all)
#   Ctrl-a Space      Cycle through layouts
#
# ==============================================================================
