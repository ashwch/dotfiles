#!/bin/bash
# Smart tmux session launcher for Ghostty
# - Uses directory basename + short hash of full path for uniqueness
# - Handles worktrees and duplicate folder names gracefully

# Use full path since this runs before shell init
TMUX="/opt/homebrew/bin/tmux"

get_session_name() {
    local dir="$PWD"

    # If in home directory, use "main"
    if [[ "$dir" == "$HOME" ]]; then
        echo "main"
        return
    fi

    # Get basename and short hash of full path
    local name hash
    name=$(basename "$dir")
    hash=$(echo -n "$dir" | md5 | cut -c1-6)

    # Sanitize: tmux session names can't have dots or colons
    name="${name//./-}"
    name="${name//:/-}"

    echo "${name}-${hash}"
}

session_name=$(get_session_name)

# Check if session exists
if $TMUX has-session -t "=$session_name" 2>/dev/null; then
    exec $TMUX attach-session -t "=$session_name"
else
    exec $TMUX new-session -s "$session_name"
fi
